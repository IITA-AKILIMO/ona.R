<p><link href="http://kevinburke.bitbucket.org/markdowncss/markdown.css" rel="stylesheet"></link></p>

<h1>Making maps using formhub.R</h1>

<p>formhub.R makes is easy to download and work with datasets on formhub.R. In this showcase, I&#39;ll show off how formhub.R makes it easy to make printable maps&hellip; just like the ones available on formhub.org for you to view.</p>

<p>This time, we&#39;ll be using a water point dataset from Northern Ghana. I am not at liberty to show you the full dataset, but maps aren&#39;t a problem. Plus, that gives me an excuse to demonstrate how formhub.R can import datasets from a file. The inputs required are two files, the <code>csv</code> file that makes up your data and the <code>form.json</code> file, which is a convenient representation of the XLSform used to collect data in the first place.</p>

<pre><code class="r"># Read north ghana water points dataset directly from saved data and form.
source(&quot;../formhub.R&quot;)
waterpoints &lt;- formhubRead(&quot;~/Downloads/_08_Water_points_train3_2012_09_06.csv&quot;, 
    &quot;~/Downloads/_08_Water_points_train3.json&quot;)
</code></pre>

<p>A quick <code>str(waterpoints)</code> can verify that the type conversions have been done properly; output excluded for brevity here.</p>

<p>Lets get to maps! A quick one just to help us get the lay of the land (longitude / latitudes are just x / y co-ordinates after all).</p>

<pre><code class="r">library(ggplot2)
qplot(data = waterpoints, x = X_water_point_geocode_longitude, y = X_water_point_geocode_latitude)
</code></pre>

<p><img src="figure/map1.png" alt="plot of chunk map1"/> </p>

<p>In order to get a real map background in there, we&#39;ll use the ggmap package, and create a baselayer for our mapping purposes. </p>

<pre><code class="r">library(ggmap)
center_point &lt;- c(lon = mean(waterpoints$X_water_point_geocode_longitude, 
    na.rm = T), lat = mean(waterpoints$X_water_point_geocode_latitude, na.rm = T))
ngbaselayer &lt;- ggmap(get_map(location = center_point, source = &quot;google&quot;, 
    filename = &quot;maptemp&quot;, zoom = 10), extent = &quot;device&quot;) + opts(legend.position = &quot;bottom&quot;)
</code></pre>

<p>Now, we can think about a property to visualize&ndash;how about the <code>water_functional</code> attribute (which corresponds to the question: Is the water source able to provide water right now?)</p>

<pre><code class="r">ngbaselayer + geom_point(data = waterpoints, aes(x = X_water_point_geocode_longitude, 
    y = X_water_point_geocode_latitude, color = water_functioning))
</code></pre>

<p><img src="figure/basemap.png" alt="plot of chunk basemap"/> </p>

<p>And here is a hexagonal binning of the counts in this dataset (with points laid over transparently), with two different bin sizes:</p>

<pre><code class="r">ngbaselayer + 
   stat_binhex(data=waterpoints, color=&quot;grey&quot;, # bins = 30 by default
         aes(x=X_water_point_geocode_longitude, y=X_water_point_geocode_latitude)) + 
   geom_point(data=waterpoints, color=&quot;orange&quot;, alpha=0.3,
         aes(x=X_water_point_geocode_longitude, y=X_water_point_geocode_latitude))
</code></pre>

<p><img src="figure/map31.png" alt="plot of chunk map3"/> </p>

<pre><code class="r">
ngbaselayer +
  stat_binhex(data=waterpoints, color=&quot;grey&quot;, bins=10,
         aes(x=X_water_point_geocode_longitude, y=X_water_point_geocode_latitude)) + 
   geom_point(data=waterpoints, color=&quot;orange&quot;, alpha=0.3,
         aes(x=X_water_point_geocode_longitude, y=X_water_point_geocode_latitude))
</code></pre>

<p><img src="figure/map32.png" alt="plot of chunk map3"/> </p>

<p>Unfortunately, I&#39;m not quite sure how we can replicate the formhub.org-style density hexbins, which tell us areas in which a high proportion of existing water points are non-functional. However, we can map where there is a prepondenderence of non-functioning water points within our set, overlaying all points for contrast:</p>

<pre><code class="r">
only_functioning_points &lt;- subset(waterpoints, water_functioning == 
    &quot;yes&quot;)
ngbaselayer + stat_binhex(data = only_functioning_points, aes(x = X_water_point_geocode_longitude, 
    y = X_water_point_geocode_latitude)) + geom_point(data = waterpoints, alpha = 0.3, 
    color = &quot;orange&quot;, aes(x = X_water_point_geocode_longitude, y = X_water_point_geocode_latitude))
</code></pre>

<p><img src="figure/map4.png" alt="plot of chunk map4"/> </p>

<p>Pretty cool, eh?<br/>
In Making Maps II with formhub.R, we will show how to make choropleth maps using shapefiles downloaded from <a href="http://gadm.org">gadm</a>.</p>
